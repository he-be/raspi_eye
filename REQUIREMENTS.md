# コミュニケーションロボット顔表示システム 要件定義書

## 1. プロジェクト概要

本プロジェクトは、コミュニケーションロボットの顔（目）を表示するシステムを開発する。外部からのコマンドに応じて、ロボットの感情や状態を視覚的に表現する。

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 基本機能
- **外部コマンド受信**: 外部システムからコマンドを受け付け、表示状態を変更
- **状態管理**: 複数の状態（ステート）を管理し、状態に応じた表示を行う
- **自然なアニメーション**: 各状態で自然な動きを表現

#### 2.1.2 表示状態（ステート）

1. **アイドル状態**
   - まばたきアニメーション（ランダムなタイミング）
   - 視線のランダム移動（キョロキョロ見回す）
   - 現在の実装をベースに使用

2. **思考中状態**
   - ディスプレイ最外周に太い矩形の枠を表示
   - 枠の色をランダムに変化させる（グラデーション、パルス効果）
   - 思考している感じを視覚的に表現

3. **発話中状態**
   - ディスプレイ最外周に白い矩形の枠を表示
   - 音声に合わせて枠を点滅（疑似リップシンク）
   - 発話の強弱に応じて点滅の強度を変更可能

#### 2.1.3 拡張性要件
- 新しい状態を容易に追加できる設計
- 各状態のアニメーションパラメータを調整可能
- プラグイン形式での状態追加をサポート

### 2.2 非機能要件

#### 2.2.1 パフォーマンス
- 60 FPSでの安定動作
- CPU使用率を最小限に抑える
- メモリ使用量の最適化

#### 2.2.2 インターフェース
- **コマンドインターフェース**: 
  - TCP/IPソケット通信
  - JSONフォーマットでのコマンド送受信
  - 非同期処理対応

#### 2.2.3 互換性
- Raspberry Pi 4での動作
- Python 3.8以上
- 720x480の固定解像度ディスプレイ

## 3. コマンドインターフェース仕様

### 3.1 コマンド形式
```json
{
  "command": "change_state",
  "state": "thinking",
  "parameters": {
    "duration": 5000,
    "intensity": 0.8
  }
}
```

### 3.2 主要コマンド
- `change_state`: 状態変更
- `set_parameter`: アニメーションパラメータ設定
- `get_status`: 現在の状態取得
- `shutdown`: システム終了

### 3.3 状態通知
```json
{
  "event": "state_changed",
  "previous_state": "idle",
  "current_state": "thinking",
  "timestamp": 1234567890
}
```

## 4. 技術仕様

### 4.1 使用技術
- **言語**: Python 3.12
- **グラフィックス**: Pygame
- **通信**: asyncio + TCP/IP
- **設定管理**: YAML/JSON

### 4.2 アーキテクチャ
- ステートマシンパターン
- オブザーバーパターン（状態変更通知）
- ストラテジーパターン（各状態の描画処理）

## 5. 開発上の制約

- 既存のグローエフェクトとキャッシングシステムを活用
- Raspberry Piのリソース制限を考慮
- リアルタイム性を重視した設計

## 6. 将来の拡張予定

- 感情表現の追加（喜び、悲しみ、驚きなど）
- 複数の目の形状サポート
- 音声認識との連携強化
- Webインターフェースでの制御